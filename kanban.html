<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIS Kanban Board</title>
    <script src="https://res.cdn.office.net/teams-js/2.0.0/js/MicrosoftTeams.min.js"></script>
    <style>
        * { box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 0; background: linear-gradient(135deg, #0079bf, #026aa7); min-height: 100vh; }
        .header { background: rgba(0,0,0,0.15); padding: 12px 20px; color: white; display: flex; align-items: center; gap: 15px; }
        .header h1 { margin: 0; font-size: 18px; font-weight: 700; }
        .header button { background: rgba(255,255,255,0.24); color: white; border: none; padding: 8px 12px; border-radius: 3px; cursor: pointer; font-size: 14px; }
        .header button:hover { background: rgba(255,255,255,0.3); }
        .save-indicator { position: fixed; top: 20px; right: 20px; background: #28a745; color: white; padding: 8px 16px; border-radius: 4px; font-size: 12px; opacity: 0; transition: opacity 0.3s; z-index: 1001; }
        .save-indicator.show { opacity: 1; }
        .board-container { padding: 20px; overflow-x: auto; height: calc(100vh - 60px); }
        .board { display: flex; gap: 12px; min-height: 100%; }
        .list { background: #ebecf0; border-radius: 3px; padding: 8px; min-width: 272px; max-width: 272px; height: fit-content; }
        .list-header { padding: 8px 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .list-title { font-size: 14px; font-weight: 600; color: #172b4d; margin: 0; }
        .list-menu { background: none; border: none; color: #6b778c; cursor: pointer; padding: 4px; border-radius: 3px; }
        .list-menu:hover { background: #ddd; }
        .list-title { cursor: pointer; }
        .list-title:hover { background: rgba(255,255,255,0.5); padding: 2px 4px; border-radius: 3px; }
        .cards { min-height: 50px; padding: 4px; }
        .cards.drag-over { background: rgba(0, 121, 191, 0.1); border: 2px dashed #0079bf; border-radius: 3px; }
        .card { background: white; border-radius: 3px; padding: 8px 12px; margin-bottom: 8px; cursor: pointer; box-shadow: 0 1px 0 rgba(9,30,66,0.25); position: relative; }
        .card:hover { box-shadow: 0 2px 4px rgba(9,30,66,0.25); }
        .card-title { font-size: 14px; color: #172b4d; margin-bottom: 4px; line-height: 1.3; }
        .card-labels { display: flex; gap: 4px; margin-bottom: 6px; flex-wrap: wrap; }
        .label { height: 8px; border-radius: 4px; min-width: 40px; }
        .label.green { background: #61bd4f; }
        .label.yellow { background: #f2d600; }
        .label.orange { background: #ff9f1a; }
        .label.red { background: #eb5a46; }
        .card-meta { display: flex; align-items: center; gap: 8px; font-size: 12px; color: #6b778c; }
        .card-date { display: flex; align-items: center; gap: 4px; }
        .card-members { display: flex; gap: 2px; }
        .member-avatar { width: 24px; height: 24px; border-radius: 50%; background: #ddd; display: flex; align-items: center; justify-content: center; font-size: 10px; color: white; font-weight: bold; }
        .add-card { background: none; border: none; color: #6b778c; padding: 8px 12px; width: 100%; text-align: left; border-radius: 3px; cursor: pointer; font-size: 14px; }
        .add-card:hover { background: #ddd; color: #172b4d; }
        .add-list { background: rgba(255,255,255,0.24); border-radius: 3px; padding: 12px; min-width: 272px; color: white; cursor: pointer; }
        .add-list:hover { background: rgba(255,255,255,0.32); }
        .card-actions { position: absolute; top: 6px; right: 6px; opacity: 0; transition: opacity 0.2s; z-index: 10; }
        .card:hover .card-actions { opacity: 1; }
        .delete-card { background: #eb5a46; color: white; border: none; width: 22px; height: 22px; border-radius: 50%; cursor: pointer; font-size: 14px; line-height: 1; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .delete-card:hover { background: #c53030; transform: scale(1.1); }
        .delete-card:active { transform: scale(0.95); }
        .dragging { opacity: 0.5; transform: rotate(5deg); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal-content { background: white; margin: 50px auto; padding: 0; width: 500px; border-radius: 3px; }
        .modal-header { padding: 20px 20px 0; border-bottom: 1px solid #ddd; }
        .modal-body { padding: 20px; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 600; color: #172b4d; font-size: 12px; text-transform: uppercase; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 8px 12px; border: 2px solid #ddd; border-radius: 3px; font-size: 14px; }
        .form-group input:focus, .form-group textarea:focus { border-color: #0079bf; outline: none; }
        .form-group textarea { height: 80px; resize: vertical; font-family: inherit; }
        .form-buttons { display: flex; gap: 8px; }
        .btn { padding: 8px 16px; border: none; border-radius: 3px; cursor: pointer; font-size: 14px; font-weight: 600; }
        .btn-primary { background: #0079bf; color: white; }
        .btn-primary:hover { background: #026aa7; }
        .btn-secondary { background: #f4f5f7; color: #172b4d; }
        .btn-secondary:hover { background: #e4e6ea; }
        .close-modal { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 20px; cursor: pointer; color: #6b778c; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìã DIS Kanban Board</h1>
        <button onclick="addNewList()">+ Add List</button>
        <button onclick="openConfigModal()">‚öôÔ∏è Configuration</button>
    </div>
    <div id="saveIndicator" class="save-indicator">Saved!</div>
    <div class="board-container">
        <div class="board" id="board"></div>
    </div>
    
    <div id="cardModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">&times;</button>
            <div class="modal-header">
                <h3 id="modalTitle">Add Card</h3>
            </div>
            <div class="modal-body">
                <form id="cardForm">
                    <div class="form-group">
                        <label>Card Title</label>
                        <input type="text" id="cardTitle" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="description" placeholder="Add a more detailed description..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Assigned To</label>
                        <input type="text" id="assignedTo" placeholder="Enter name or email">
                    </div>
                    <div class="form-group">
                        <label>Due Date</label>
                        <input type="date" id="dueDate">
                    </div>
                    <div class="form-group">
                        <label>Priority</label>
                        <select id="priority">
                            <option value="">No Priority</option>
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="btn btn-primary">Save Card</button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="configModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeConfigModal()">&times;</button>
            <div class="modal-header">
                <h3>Data Storage Configuration</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Storage Type</label>
                    <select id="storageType" onchange="toggleStorageOptions()">
                        <option value="localStorage">Local Storage (Browser Only)</option>
                        <option value="jsonbin">JSONBin.io (Free Cloud)</option>
                        <option value="github">GitHub Gist (Free)</option>
                        <option value="pastebin">Pastebin (Simple)</option>
                    </select>
                </div>
                <div id="cloudOptions" style="display: none;">
                    <div class="form-group">
                        <label>API URL/ID</label>
                        <input type="text" id="apiUrl" placeholder="Enter API URL or ID">
                        <small id="urlHelp" style="color: #666; font-size: 11px;">Instructions will appear based on selected storage type</small>
                    </div>
                    <div class="form-group">
                        <label>Access Token (Optional)</label>
                        <input type="text" id="accessToken" placeholder="Enter access token if required">
                    </div>
                </div>
                <div class="form-group">
                    <label>Current Status</label>
                    <div id="configStatus" style="padding: 8px; background: #f8f9fa; border-radius: 4px; font-size: 12px;">Not configured</div>
                </div>
                <div class="form-buttons">
                    <button type="button" class="btn btn-primary" onclick="saveStorageConfig()">Save Configuration</button>
                    <button type="button" class="btn btn-secondary" onclick="testStorage()">Test Connection</button>
                    <button type="button" class="btn btn-secondary" onclick="closeConfigModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Teams
        try {
            microsoftTeams.app.initialize();
        } catch (e) {
            console.log('Not in Teams environment');
        }
        
        // Global variables
        let lists = ['üìã Backlog', 'üîÑ In Progress', 'üëÄ Review', '‚úÖ Done'];
        let currentList = '';
        let editingCard = null;
        let allCards = [];
        
        // Initialize board
        function initBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            
            // Create lists
            lists.forEach(listName => {
                createList(listName);
            });
            
            // Add "Add List" button
            const addListEl = document.createElement('div');
            addListEl.className = 'add-list';
            addListEl.innerHTML = '+ Add another list';
            addListEl.onclick = addNewList;
            board.appendChild(addListEl);
        }
        
        function createList(name) {
            const board = document.getElementById('board');
            const list = document.createElement('div');
            list.className = 'list';
            list.innerHTML = `
                <div class="list-header">
                    <h3 class="list-title" onclick="editListName('${name}')">${name}</h3>
                    <button class="list-menu" onclick="deleteList('${name}')">‚ãØ</button>
                </div>
                <div id="${name.replace(/[^a-zA-Z0-9]/g, '')}" class="cards"></div>
                <button class="add-card" onclick="openCardModal('${name}')">+ Add a card</button>
            `;
            board.appendChild(list);
            setupDropZone(name.replace(/[^a-zA-Z0-9]/g, ''));
        }
        
        function addNewList() {
            const name = prompt('Enter list name:');
            if (name && name.trim() && !lists.includes(name)) {
                lists.push(name);
                saveData();
                initBoard();
                loadCards();
            }
        }
        
        function editListName(oldName) {
            const newName = prompt('Enter new list name:', oldName);
            if (newName && newName.trim() && newName !== oldName && !lists.includes(newName)) {
                // Update lists array
                const index = lists.indexOf(oldName);
                if (index !== -1) {
                    lists[index] = newName;
                }
                
                // Update cards status
                allCards.forEach(card => {
                    if (card.status === oldName) {
                        card.status = newName;
                    }
                });
                
                // Save and refresh
                saveData();
                initBoard();
                loadCards();
            }
        }
        
        function deleteList(name) {
            if (confirm(`Delete "${name}" list?`)) {
                lists = lists.filter(l => l !== name);
                allCards = allCards.filter(c => c.status !== name);
                saveData();
                initBoard();
                loadCards();
            }
        }
        
        function openCardModal(list) {
            currentList = list;
            editingCard = null;
            document.getElementById('modalTitle').textContent = 'Add Card';
            document.getElementById('cardForm').reset();
            document.getElementById('cardModal').style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('cardModal').style.display = 'none';
        }
        
        function getPriorityLabel(priority) {
            const labels = {
                'low': 'green',
                'medium': 'yellow', 
                'high': 'orange',
                'urgent': 'red'
            };
            return labels[priority] || '';
        }
        
        function getInitials(name) {
            return name ? name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2) : '';
        }
        
        function createCardElement(card) {
            const cardEl = document.createElement('div');
            cardEl.className = 'card';
            cardEl.draggable = true;
            cardEl.dataset.cardId = card.id;
            
            const labels = card.priority ? `<div class="card-labels"><div class="label ${getPriorityLabel(card.priority)}"></div></div>` : '';
            const member = card.assignedTo ? `<div class="member-avatar">${getInitials(card.assignedTo)}</div>` : '';
            const date = card.dueDate ? `<div class="card-date">üìÖ ${new Date(card.dueDate).toLocaleDateString()}</div>` : '';
            
            cardEl.innerHTML = `
                <div class="card-actions">
                    <button class="delete-card">&times;</button>
                </div>
                ${labels}
                <div class="card-title">${card.title}</div>
                <div class="card-meta">
                    ${date}
                    <div class="card-members">${member}</div>
                </div>
            `;
            
            // Add delete button event listener
            const deleteBtn = cardEl.querySelector('.delete-card');
            deleteBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                deleteCard(e, card.id, card.title);
            });
            
            cardEl.onclick = (e) => {
                if (!e.target.classList.contains('delete-card')) {
                    editCard(card, cardEl);
                }
            };
            
            cardEl.ondragstart = (e) => {
                e.dataTransfer.setData('application/json', JSON.stringify(card));
                e.dataTransfer.effectAllowed = 'move';
                cardEl.classList.add('dragging');
                
                // Add visual feedback to all drop zones
                setTimeout(() => {
                    document.querySelectorAll('.cards').forEach(zone => {
                        if (!zone.contains(cardEl)) {
                            zone.style.minHeight = '60px';
                            zone.style.border = '2px dashed #ccc';
                        }
                    });
                }, 0);
            };
            
            cardEl.ondragend = (e) => {
                cardEl.classList.remove('dragging');
                
                // Remove visual feedback from all drop zones
                document.querySelectorAll('.cards').forEach(zone => {
                    zone.classList.remove('drag-over');
                    zone.style.minHeight = '';
                    zone.style.border = '';
                });
            };
            
            return cardEl;
        }
        
        function editCard(card, element) {
            editingCard = { card, element };
            document.getElementById('modalTitle').textContent = 'Edit Card';
            document.getElementById('cardTitle').value = card.title;
            document.getElementById('description').value = card.description || '';
            document.getElementById('assignedTo').value = card.assignedTo || '';
            document.getElementById('dueDate').value = card.dueDate || '';
            document.getElementById('priority').value = card.priority || '';
            document.getElementById('cardModal').style.display = 'block';
        }
        
        function deleteCard(event, cardId, cardTitle) {
            event.preventDefault();
            event.stopPropagation();
            
            if (confirm(`Delete "${cardTitle}"?`)) {
                console.log('Deleting card ID:', cardId);
                
                // Find and remove card element
                const cardElement = document.querySelector(`[data-card-id="${cardId}"]`);
                if (cardElement) {
                    cardElement.remove();
                }
                
                // Remove from array
                allCards = allCards.filter(c => c.id != cardId);
                
                // Save data
                saveData();
                
                console.log('Card deleted successfully');
            }
        }
        
        function setupDropZone(listId) {
            const list = document.getElementById(listId);
            if (!list) return;
            
            list.ondragover = (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                list.classList.add('drag-over');
            };
            
            list.ondragleave = (e) => {
                // Only remove highlight if leaving the drop zone completely
                if (!list.contains(e.relatedTarget)) {
                    list.classList.remove('drag-over');
                }
            };
            
            list.ondrop = (e) => {
                e.preventDefault();
                list.classList.remove('drag-over');
                
                const cardData = JSON.parse(e.dataTransfer.getData('application/json'));
                const newStatus = lists.find(l => l.replace(/[^a-zA-Z0-9]/g, '') === listId);
                
                // Don't do anything if dropping in the same list
                if (cardData.status === newStatus) {
                    return;
                }
                
                cardData.status = newStatus;
                
                // Remove original card
                const draggedCard = document.querySelector('.dragging');
                if (draggedCard) {
                    const cardId = draggedCard.dataset.cardId;
                    const cardIndex = allCards.findIndex(c => c.id == cardId);
                    if (cardIndex !== -1) {
                        allCards[cardIndex].status = newStatus;
                        saveData();
                    }
                    draggedCard.remove();
                }
                
                // Add to new list
                list.appendChild(createCardElement(cardData));
            };
        }
        
        // Form submission
        document.getElementById('cardForm').onsubmit = (e) => {
            e.preventDefault();
            
            const card = {
                id: editingCard ? editingCard.card.id : Date.now(),
                title: document.getElementById('cardTitle').value,
                description: document.getElementById('description').value,
                assignedTo: document.getElementById('assignedTo').value,
                dueDate: document.getElementById('dueDate').value,
                priority: document.getElementById('priority').value,
                status: currentList
            };
            
            if (editingCard) {
                const cardIndex = allCards.findIndex(c => c.id === editingCard.card.id);
                if (cardIndex !== -1) {
                    allCards[cardIndex] = card;
                }
                editingCard.element.replaceWith(createCardElement(card));
            } else {
                allCards.push(card);
                const listEl = document.getElementById(currentList.replace(/[^a-zA-Z0-9]/g, ''));
                if (listEl) {
                    listEl.appendChild(createCardElement(card));
                }
            }
            
            saveData();
            closeModal();
        };
        
        // Save data with visual feedback
        async function saveData() {
            // Save to localStorage as fallback
            localStorage.setItem('kanban-cards', JSON.stringify(allCards));
            localStorage.setItem('kanban-lists', JSON.stringify(lists));
            
            // Try to save to cloud if configured
            if (storageConfig.type !== 'localStorage') {
                const cloudData = { lists, cards: allCards, timestamp: new Date().toISOString() };
                await saveToCloud(cloudData);
            }
            
            showSaveIndicator();
            console.log('Data saved:', { lists, cards: allCards.length });
        }
        

        

        
        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }
        
        // Configuration variables
        let storageConfig = {
            type: 'localStorage',
            apiUrl: '',
            accessToken: '',
            lastSync: null
        };
        
        function openConfigModal() {
            loadExcelConfig();
            document.getElementById('configModal').style.display = 'block';
        }
        
        function closeConfigModal() {
            document.getElementById('configModal').style.display = 'none';
        }
        
        function loadExcelConfig() {
            const saved = localStorage.getItem('storage-config');
            if (saved) {
                storageConfig = { ...storageConfig, ...JSON.parse(saved) };
                document.getElementById('storageType').value = storageConfig.type || 'localStorage';
                document.getElementById('apiUrl').value = storageConfig.apiUrl || '';
                document.getElementById('accessToken').value = storageConfig.accessToken || '';
                toggleStorageOptions();
                updateConfigStatus();
            }
        }
        
        function toggleStorageOptions() {
            const type = document.getElementById('storageType').value;
            const cloudOptions = document.getElementById('cloudOptions');
            const urlHelp = document.getElementById('urlHelp');
            
            if (type === 'localStorage') {
                cloudOptions.style.display = 'none';
            } else {
                cloudOptions.style.display = 'block';
                
                const helpTexts = {
                    'jsonbin': 'Create free account at jsonbin.io, create a bin, copy the bin ID',
                    'github': 'Create GitHub Gist, copy the Gist ID from URL',
                    'pastebin': 'Create Pastebin paste, copy the paste ID from URL'
                };
                
                urlHelp.textContent = helpTexts[type] || 'Enter the appropriate URL or ID';
            }
        }
        
        function saveStorageConfig() {
            storageConfig.type = document.getElementById('storageType').value;
            storageConfig.apiUrl = document.getElementById('apiUrl').value;
            storageConfig.accessToken = document.getElementById('accessToken').value;
            
            localStorage.setItem('storage-config', JSON.stringify(storageConfig));
            updateConfigStatus();
            alert('Configuration saved!');
        }
        
        function updateConfigStatus() {
            const status = document.getElementById('configStatus');
            
            if (storageConfig.type === 'localStorage') {
                status.innerHTML = '‚úÖ Using Local Storage (Browser Only)';
                status.style.background = '#fff3cd';
            } else if (storageConfig.apiUrl) {
                status.innerHTML = `‚úÖ Using ${storageConfig.type.toUpperCase()}: ${storageConfig.apiUrl}`;
                status.style.background = '#d4edda';
            } else {
                status.innerHTML = '‚ùå Not configured';
                status.style.background = '#f8d7da';
            }
        }
        
        async function testStorage() {
            if (storageConfig.type === 'localStorage') {
                alert('‚úÖ Local Storage is working!');
                return;
            }
            
            if (!storageConfig.apiUrl) {
                alert('Please enter API URL/ID first');
                return;
            }
            
            if (!storageConfig.accessToken) {
                alert('Please enter Access Token first');
                return;
            }
            
            try {
                console.log('Testing connection...');
                console.log('Bin ID:', storageConfig.apiUrl);
                console.log('Access Token:', storageConfig.accessToken.substring(0, 10) + '...');
                
                const testData = { 
                    test: 'connection', 
                    timestamp: new Date().toISOString(),
                    message: 'Test from Kanban App'
                };
                
                const success = await saveToCloud(testData, true);
                
                if (success) {
                    alert('‚úÖ Connection test successful!\n\nData saved to JSONBin successfully.');
                } else {
                    alert('‚ùå Connection test failed\n\nCheck Console (F12) for detailed error messages.');
                }
            } catch (error) {
                console.error('Test connection error:', error);
                alert(`‚ùå Connection error: ${error.message}\n\nCommon issues:\n- Invalid Bin ID\n- Invalid Access Token\n- Network/CORS issues`);
            }
        }
        
        // Cloud storage functions
        async function saveToCloud(data, isTest = false) {
            if (storageConfig.type === 'localStorage') return false;
            
            try {
                switch (storageConfig.type) {
                    case 'jsonbin':
                        return await saveToJSONBin(data, isTest);
                    case 'github':
                        return await saveToGitHubGist(data, isTest);
                    case 'pastebin':
                        return await saveToPastebin(data, isTest);
                    default:
                        return false;
                }
            } catch (error) {
                console.error('Cloud save error:', error);
                return false;
            }
        }
        
        async function loadFromCloud() {
            if (storageConfig.type === 'localStorage') return null;
            
            try {
                switch (storageConfig.type) {
                    case 'jsonbin':
                        return await loadFromJSONBin();
                    case 'github':
                        return await loadFromGitHubGist();
                    case 'pastebin':
                        return await loadFromPastebin();
                    default:
                        return null;
                }
            } catch (error) {
                console.error('Cloud load error:', error);
                return null;
            }
        }
        
        // JSONBin.io integration (free tier)
        async function saveToJSONBin(data, isTest) {
            try {
                const url = `https://api.jsonbin.io/v3/b/${storageConfig.apiUrl}`;
                console.log('=== JSONBin Save Request ===');
                console.log('URL:', url);
                console.log('Method: PUT');
                console.log('Headers:', {
                    'Content-Type': 'application/json',
                    'X-Master-Key': storageConfig.accessToken.substring(0, 10) + '...'
                });
                
                const payload = {
                    appName: 'Kanban Teams App',
                    lastUpdated: new Date().toISOString(),
                    ...data
                };
                console.log('Payload:', payload);
                
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': storageConfig.accessToken,
                        'X-Bin-Private': 'false'
                    },
                    body: JSON.stringify(payload)
                });
                
                console.log('Response status:', response.status);
                console.log('Response headers:', Object.fromEntries(response.headers.entries()));
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('‚úÖ JSONBin save SUCCESS:', result);
                    return true;
                } else {
                    const errorText = await response.text();
                    console.error('‚ùå JSONBin save FAILED:');
                    console.error('Status:', response.status, response.statusText);
                    console.error('Error:', errorText);
                    
                    // Show specific error messages
                    if (response.status === 401) {
                        console.error('Authentication failed - check Access Token');
                    } else if (response.status === 404) {
                        console.error('Bin not found - check Bin ID');
                    } else if (response.status === 403) {
                        console.error('Permission denied - check bin permissions');
                    }
                    
                    return false;
                }
            } catch (error) {
                console.error('‚ùå JSONBin save EXCEPTION:', error);
                
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    console.error('Network error - check internet connection or CORS policy');
                }
                
                return false;
            }
        }
        
        async function loadFromJSONBin() {
            try {
                const url = `https://api.jsonbin.io/v3/b/${storageConfig.apiUrl}/latest`;
                console.log('=== JSONBin Load Request ===');
                console.log('URL:', url);
                console.log('Method: GET');
                
                const response = await fetch(url, {
                    headers: {
                        'X-Master-Key': storageConfig.accessToken
                    }
                });
                
                console.log('Response status:', response.status);
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('‚úÖ JSONBin load SUCCESS:', result);
                    return result.record;
                } else {
                    const errorText = await response.text();
                    console.error('‚ùå JSONBin load FAILED:');
                    console.error('Status:', response.status, response.statusText);
                    console.error('Error:', errorText);
                    return null;
                }
            } catch (error) {
                console.error('‚ùå JSONBin load EXCEPTION:', error);
                return null;
            }
        }
        
        // GitHub Gist integration
        async function saveToGitHubGist(data, isTest) {
            // Simplified - would need GitHub API
            console.log('Would save to GitHub Gist:', storageConfig.apiUrl);
            return true; // Demo
        }
        
        async function loadFromGitHubGist() {
            console.log('Would load from GitHub Gist:', storageConfig.apiUrl);
            return null; // Demo
        }
        
        // Pastebin integration
        async function saveToPastebin(data, isTest) {
            console.log('Would save to Pastebin:', storageConfig.apiUrl);
            return true; // Demo
        }
        
        async function loadFromPastebin() {
            console.log('Would load from Pastebin:', storageConfig.apiUrl);
            return null; // Demo
        }
        
        // Load cards from Excel or localStorage
        async function loadCards() {
            // Clear existing cards first
            document.querySelectorAll('.cards').forEach(list => {
                list.innerHTML = '';
            });
            
            // Try to load from cloud first
            const cloudData = await loadFromCloud();
            
            if (cloudData && cloudData.cards) {
                allCards = cloudData.cards;
                if (cloudData.lists) lists = cloudData.lists;
                console.log('Loaded from cloud:', cloudData);
            } else {
                // Fallback to localStorage
                const savedCards = localStorage.getItem('kanban-cards');
                if (savedCards) {
                    try {
                        allCards = JSON.parse(savedCards);
                        console.log('Loaded cards from localStorage:', allCards.length);
                    } catch (e) {
                        console.error('Error loading cards:', e);
                        allCards = [];
                    }
                } else {
                    // Add sample cards
                    const sampleCards = [
                        { id: 1, title: 'User Authentication System', assignedTo: 'John Doe', priority: 'high', dueDate: '2024-02-15', status: 'üìã Backlog' },
                        { id: 2, title: 'Dashboard UI Design', assignedTo: 'Jane Smith', priority: 'medium', dueDate: '2024-02-20', status: 'üîÑ In Progress' },
                        { id: 3, title: 'API Integration', assignedTo: 'Mike Johnson', priority: 'urgent', dueDate: '2024-02-10', status: 'üëÄ Review' },
                        { id: 4, title: 'Database Migration', assignedTo: 'Sarah Wilson', priority: 'low', dueDate: '2024-01-30', status: '‚úÖ Done' }
                    ];
                    
                    allCards = sampleCards;
                    await saveData();
                }
            }
            
            // Render cards
            allCards.forEach(card => {
                const listEl = document.getElementById(card.status.replace(/[^a-zA-Z0-9]/g, ''));
                if (listEl) {
                    listEl.appendChild(createCardElement(card));
                }
            });
        }
        
        // Load saved lists
        function loadLists() {
            const savedLists = localStorage.getItem('kanban-lists');
            if (savedLists) {
                try {
                    lists = JSON.parse(savedLists);
                    console.log('Loaded lists:', lists);
                } catch (e) {
                    console.error('Error loading lists:', e);
                    lists = ['üìã Backlog', 'üîÑ In Progress', 'üëÄ Review', '‚úÖ Done'];
                }
            } else {
                saveData();
            }
        }
        
        // Initialize app
        async function init() {
            loadExcelConfig();
            loadLists();
            initBoard();
            await loadCards();
        }
        
        // Prevent modal from closing when clicking inside
        document.querySelectorAll('.modal-content').forEach(content => {
            content.onclick = (e) => e.stopPropagation();
        });
        document.getElementById('cardModal').onclick = closeModal;
        document.getElementById('configModal').onclick = closeConfigModal;
        
        // Start the app
        init();
    </script>
</body>
</html>